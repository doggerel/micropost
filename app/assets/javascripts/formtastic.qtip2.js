// formtastic.qtip2.js
//
// author: Gyorgy Schreiber
// gydotschreiberatmobilitydothu
//
// this script allows a simple replacement of formtastic's inline hints with qTip2
// tooltips for all formtastic forms in your rails app by binding a qtip to the
// parent of each '.inline-hints' class element of the app's pages (those normally
// should be the default hints generated by formtastic).
//
// REQUIRES:
// formtastic - https://github.com/justinfrench/formtastic
// jQuery (for qTip2) - http://jquery.com/
// qTip2 - http://craigsworks.com/projects/qtip2/
//
// INSTALLATION:
// (assuming you have a rails app set up with formtastic and jQuery > 1.4.2)
// 1) include this file in your app's javascripts directory (optionally you can
//    use the min version of this file)
// 2) add the following line to your application.html.erb (and other templates
//    where you intend to use qTip2 for formtastic):
//   <%= javascript_include_tag 'jquery.qtip.min', 'formtastic.qtip2.min' %>
//   also include the qTip2 CSS
//   <%= stylesheet_link_tag 'jquery.qtip.min.css' %>
// 3) you should reload a page that was displaying a formtastic form with inline
//   hints and you should see those hints gone (hidden) and a qTip2 tooltip should
//   pop-up as the mouse moves over the formtastic input element showing the text
//   of the inline hint... enjoy! :)
//
// LICENSING:
// GPL & MIT dual license (as qTip2)
// GPL - http://www.gnu.org/copyleft/gpl.html
//
// MIT License
// Copyright (C) 2012 Gyorgy Schreiber (gydotschreiberatmobilitydothu)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy of
// this software and associated documentation files (the "Software"), to deal in
// the Software without restriction, including without limitation the rights to
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
// of the Software, and to permit persons to whom the Software is furnished to do
// so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.


// hide all inline-hints
$(".inline-hints").hide();
// set qtip2 tooltips in conjunction with formtastic's 'inline-hints' class
$(".inline-hints").each(function(){
  var input = $(this.parentNode);
  //$(this).hide();   // hide the inline-hint
  // assign tooltip
  input.qtip({
    position: {at: "bottom middle", my: "top middle"},
    content: {text: function(api) {
         var hinttext = $(this)[0].lastChild.firstChild.parentElement.attributes[0].nodeName == 'class' && $(this)[0].lastChild.firstChild.parentElement.attributes[0].nodeValue == 'inline-errors' ? $(this)[0].children[$(this)[0].children.length-2].firstChild.wholeText : $(this)[0].lastChild.firstChild.wholeText;
         return hinttext;
         //return $(this)[0].children[2].firstChild.wholeText;
        }
      }
  });
});
